# webServerBase

Crtl+Shift+v

GoLang based ReST based Server

## Packages

* **servermain** - This is where all the server code resides
  * Dependends on **config** and **logging**
  * Does NOT depend on any other package (except standard go)
* **config** - This is where the configuration data is read and accessed
* **logging** - This is an enhanced logging framework for the server logs
* **test** - Tools used during testing. Asserts and the like!

## Directories

* **site** - Directory without code (TEST DATA ONLY).
  * This is for testing only and has test data files such as:
    * icons, html, json and even some xml. See webServerTest.json for paths to this diractory
* **templates** - Directory without code (TEST DATA ONLY).
  * This is for testing only contain templates and templat configuration files
* **.vscode** - Configuration files for Visual Studio Code IDE.
  * launch.json - for build and run (stand alone)
  * tasks.json for debugging (stand alone)

## Files (in root dir)

* **webServerBase.code-workspace** - File used by Visual Studio Code IDE
* **webServerExample.go** - Web server for **TEST** purposes and as a model for other servers
* **webServerExample_test.go** - Tests for **webServerExample.go**:
  * Start server.
  * Do loads of tests.
  * Stop server!
* **webServerExample_test.json** - Specific configuration file for **webServerExample_test.go**.
* **go.mod** and **go.sum** - These are generated by the go modules system and define dependencies for the project. Currently the project has no external deps so the definition in here '**replaces**' the dependency with the local packages. For example **config** and **logging**. If these are missing use ```go mod init <mainmodule>```. To updete the dependencies use ```go mod tidy```.
* README.md - This file!
* **LICENSE** - The open source lisence for this application

## Configuration

The server '**servermain**' and '**logging**' packages are NOT configured using the 'config' package. Creating a server and configuring the logs is done using standard Go types such as map and array. This separation is necessary so that '**servermain**' and '**logging**' can be used without constraining it to predefined configuration types and simplifies dependencies.

## Server Configuration

### See webServerExample.go in the root directory for a complete example!

The sturcture **ServerInstanceData** in the **servermain** package defines the configuration of a server instance. The code in th e**servermain** package uses this data to create an instance of a server. Multiple servers can be created by creating multiple **ServerInstanceData** objects.

A factory method **NewServerInstanceData** is called to create and validate a **ServerInstanceData** object. It returns a pointer to the **ServerInstanceData**.

**NewServerInstanceData** has the following parameters:

* baseHandlerNameIn string - Is the 'Name of the server'
  * This is the prefered name of the server for loggin pusposes. For example:
  * ```2019/09/25 14:52:26.350161 <baseHandlerNameIn>:8080 ServerMain [-]   INFO Server will start on port 8080```
* contentTypeCharsetIn string - Is the default response character set (utf-8).
  * So this is the default value for the ContentType header. For example a JSON response header would be:
    * application/json; charset=utf-8
    * The application/json is derived from the code. See later for details
    * The charset=utf-8 is derive from "charset=" + contentTypeCharsetIn.

## Server start

To start the server use the **ListenAndServeOnPort(port int)** method bound to **ServerInstanceData**

For example:

``` go
serverInstance = servermain.NewServerInstanceData("MyServer", "utf-8)
...
serverInstance.ListenAndServeOnPort(8080)
```

## Logger Configuration

The logger (package "logger") is a wrapper for the Go 'log' package. This package manages to writes to all logs. The logger wrapper adds functionality to the standard go package.

The function **CreateLogWithFilenameAndAppID** is used to create the logger data structure. It does NOT return a reference to this data structure as the logger is a singleton and simply requires initialiasation.

The parameters to **CreateLogWithFilenameAndAppID** initialise the logger and the various logger levels.

* **defaultLogFileNameIn string** - Is the default file name for loggers that write to files.
  * If this is an empty string then the default output will  be system out (console)
  * If this is a file name then further logging the writes to the default file will append to this log.
* **applicationID string** - This is the name associated with the log:
  * ```2019/09/25 14:52:26.350161 <applicationID>:8080 ServerMain [-]   INFO Server will start on port 8080```
* **fatalRCIn int** - This is the application return code for 'Fatal' errors that cause the server to exit.
  * The **Fatal** log function logs a message and stack trace. If fatalRCIn is NON zero it will finally terminate the server application returning the value of fatalRCIn to the operating system.
* **logLevelActivationData map[string]string** - Defines the output and active properties for each log level.
  * The log levels are currently: 
    * **DEBUG** - Used by the developers for diagnostic (non error) log entries
    * **INFO** - General information log entries
    * **ACCESS**
      * Used to log requests to the server (including request headers if **DEBUG** is active)
      * Used to log responses from the server (including response headers if **DEBUG** is active)
    * **WARN** - Used to indicate non-critical errors that do not impact functionality but should be logged
    * **ERROR** - Used to indicate critical errors that will impact functionality but do not impact the overall server function
    * **FATAL** - The server cannot continue to function. If **fatalRCIn** is non zero then Exit and return **fatalRCIn** as the response code

Unlike most loggers there is no implied hierarchy to the log levels dispite being called levels. In this logger all levels are independent and each one is separatly configurable.

Each log level can be configured as follows:

* **OFF** (or inactive) - No logging will take place. A call to the function Is* will return false. For example **IsDebug()** will return false if **DEBUG** is OFF, IsWarn() will return true if **WARN** is not OFF.
* **DEFAULT** (active) - Log lines will be written to  **defaultLogFileNameIn** if it is defined. If not then log lines will be written to the console (SYSOUT).
* **SYSOUT** - Log lines will be written to the console (system out)
* **SYSERR** - Log lines will be written to the console (system error out)
* **FileName** - If a file name is given then the log lines will be appended to that file. This is independent of **defaultLogFileNameIn**.

The default state for each log level is as follows:

* **DEBUG** - OFF
* **INFO** - OFF
* **ACCESS** - OFF
* **WARN** - OFF
* **ERROR** - SYSERR
* **FATAL** - SYSERR

The **CreateTestLogger()** function sets ALL log levels to **SYSOUT** except for **ERROR** and **FATAL** which remain as **SYSERR**

``` Go
CreateLogWithFilenameAndAppID
```
